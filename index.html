<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portal Proiecte</title>
  <style>
    :root{--bg:#0f172a;--panel:#111827;--text:#e5e7eb;}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
    header{position:sticky;top:0;z-index:50;background:#111827;border-bottom:1px solid #263241}
    .container{max-width:1200px;margin:0 auto;padding:10px 16px;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .brand{font-weight:700;display:flex;gap:8px;align-items:center}
    .dot{width:10px;height:10px;border-radius:50%;background:linear-gradient(135deg,#22d3ee,#38bdf8)}
    .btn{background:#1e293b;border:1px solid #2b3b4e;border-radius:10px;color:inherit;padding:8px 12px;text-decoration:none;cursor:pointer}
    .btn:hover{background:#334155}
    .menu{position:relative}
    .menu-list{display:none;position:absolute;top:calc(100% + 6px);left:0;min-width:220px;background:#1e293b;border:1px solid #334155;border-radius:12px;padding:8px;box-shadow:0 14px 30px rgba(0,0,0,.35);max-height:60vh;overflow:auto}
    .menu[aria-expanded="true"] .menu-list{display:block}
    .menu-title{font-size:12px;text-transform:uppercase;opacity:.7;margin:4px 6px}
    .item{padding:8px 10px;border-radius:8px;cursor:pointer}
    .item:hover{background:#334155}
    main{display:flex;gap:18px;max-width:1200px;margin:20px auto;padding:0 16px}
    aside{width:250px}
    aside a{display:block;color:inherit;text-decoration:none;padding:8px;border-radius:10px}
    aside a:hover{background:#334155}
    #content{flex:1;background:#1e293b;border:1px solid #263241;border-radius:14px;min-height:60vh;padding:20px}
    .content-inner{max-width:100%;margin:0 auto}
    code{background:#0b1220;border-radius:6px;padding:2px 6px}
    .viewer{width:100%;min-height:60vh;border:0;border-radius:14px;background:#0b1220}
  </style>
</head>
<body>
<header>
  <div class="container">
    <div class="brand"><span class="dot"></span><span>Portal Proiecte</span></div>
    <a class="btn" href="#home" data-route>üè† HOME</a>
    <a class="btn" href="#admin" data-route>‚öôÔ∏è Admin</a>
    <button class="btn" id="regen-manifest">üîÑ RegenereazƒÉ manifest</button>
    <div id="menus" style="display:flex;gap:6px;flex-wrap:wrap;margin-left:auto"></div>
  </div>
</header>

<main class="main">
  <aside class="sidebar">
    <div class="card">
      <a class="side-link" href="#limbi" data-route>Limbi strƒÉine</a>
      <a class="side-link" href="#skilluri" data-route>Skilluri</a>
      <a class="side-link" href="#filme" data-route>Filme</a>
      <a class="side-link" href="#carti" data-route>CƒÉr»õi</a>
    </div>
  </aside>
  <section id="content"><div class="content-inner" id="content-inner"></div></section>
</main>

<script>
const view = document.getElementById('content-inner');
const content = document.getElementById('content');
const menusRoot = document.getElementById('menus');

const HUMAN_TITLES = {
  personal:'üìÅ Proiecte personale', media:'üì∑ Photo / Video / Drone',
  '3d':'üß± 3D Design', auto:'‚öôÔ∏è AutomatizƒÉri', prog:'üíª Programare',
  db:'üóÑÔ∏è DataBases', net:'üåê Network', game:'üéÆ Gaming',
  'plc-siemens':'PLC Siemens', itinfrastructure:'IT_infrastructure'
};

function toTitle(slug){
  if(HUMAN_TITLES[slug]) return HUMAN_TITLES[slug];
  return slug.replace(/[-_]/g,' ').split(' ').map(s=>s?s[0].toUpperCase()+s.slice(1):s).join(' ');
}

// ------- Manifest loader (HTTP) sau fallback local (file://) -------
async function loadManifestHTTP(){
  try{
    const res = await fetch('pages/_manifest.json?v='+Date.now(), {cache:'no-store'});
    if(!res.ok) throw new Error('HTTP '+res.status);
    return await res.json();
  }catch(e){
    console.warn('Manifest HTTP e»ôuat:', e);
    return null;
  }
}

async function buildMenusFromManifest(manifest){
  menusRoot.innerHTML = '';
  Object.keys(manifest).forEach(cat=>{
    const items = manifest[cat];
    const menu = document.createElement('div'); menu.className='menu'; menu.setAttribute('aria-expanded','false');
    const btn = document.createElement('button'); btn.className='btn'; btn.textContent = toTitle(cat) + ' ‚ñæ';
    const list = document.createElement('div'); list.className='menu-list';
    const section = document.createElement('div'); section.className='menu-section';
    const title = document.createElement('div'); title.className='menu-title'; title.textContent='Proiecte';
    section.appendChild(title);
    items.forEach(file=>{
      const item = document.createElement('div'); item.className='item'; item.setAttribute('data-open', `${cat}/${file}`); item.textContent=toTitle(file);
      item.addEventListener('click',()=>{ location.hash = `${cat}/${file}`; closeAllMenus(); });
      section.appendChild(item);
    });
    list.appendChild(section); menu.appendChild(btn); menu.appendChild(list); menusRoot.appendChild(menu);
  });
}

async function buildMenusFromPicker(){
  if (!window.showDirectoryPicker){
    alert('Pentru mod local fƒÉrƒÉ server folose»ôte Chrome/Edge desktop.');
    return;
  }
  const dirHandle = await window.showDirectoryPicker({ id:'pick-pages' });
  const manifest = {};
  for await (const [name, handle] of dirHandle.entries()){
    if (handle.kind === 'directory'){
      const files = [];
      for await (const [fname, fhandle] of handle.entries()){
        const low = fname.toLowerCase();
        if (fhandle.kind === 'file' && low.endsWith('.html')){
          files.push(low.replace(/\\.html$/,''));
        }
      }
      if (files.length) manifest[name] = files.sort();
    }
  }
  await buildMenusFromManifest(manifest);
}

// ------- Render (cu IFRAME) -------
async function render(route){
  const key = route || 'home';
  content.setAttribute('aria-busy','true');

  if (!key || key === 'home'){
    view.innerHTML = `<h1>Bun venit! üëã</h1><p>Alege un proiect din meniu.</p>`;
    content.setAttribute('aria-busy','false');
    return;
  }

  const url = `pages/${key}.html?v=` + Date.now(); // cache-buster
  view.innerHTML = '';
  const frame = document.createElement('iframe');
  frame.className = 'viewer';
  frame.loading = 'lazy';
  frame.src = url;
  frame.addEventListener('error', ()=> {
    view.innerHTML = `<h1>Pagina nu a fost gƒÉsitƒÉ</h1><p>Nu pot √ÆncƒÉrca <code>${url}</code>.</p>`;
    content.setAttribute('aria-busy','false');
  });
  frame.addEventListener('load', ()=> content.setAttribute('aria-busy','false'));
  view.appendChild(frame);
}

// ------- Dropdown handling -------
function closeAllMenus(){ document.querySelectorAll('.menu').forEach(m=> m.setAttribute('aria-expanded','false')); }
document.addEventListener('click', (e)=>{
  const m = e.target.closest('div.menu');
  if(m){ const open = m.getAttribute('aria-expanded')==='true'; closeAllMenus(); m.setAttribute('aria-expanded', String(!open)); }
  else { closeAllMenus(); }
});

// ------- Manifest √Æn browser (scrie pe disc local) -------
async function generateManifestInBrowser(){
  if (!window.showDirectoryPicker){ alert('Browserul nu suportƒÉ Directory Picker.'); return; }
  try{
    const dirHandle = await window.showDirectoryPicker({ id: 'pick-pages' });
    const manifest = {};
    for await (const [name, handle] of dirHandle.entries()){
      if (handle.kind === 'directory'){
        const files = [];
        for await (const [fname, fhandle] of handle.entries()){
          const low = fname.toLowerCase();
          if (fhandle.kind === 'file' && low.endsWith('.html')){
            files.push(low.replace(/\\.html$/,''));
          }
        }
        if (files.length) manifest[name] = files.sort();
      }
    }
    const fileHandle = await dirHandle.getFileHandle('_manifest.json', { create: true });
    const writable = await fileHandle.createWritable();
    await writable.write(new Blob([JSON.stringify(manifest, null, 2)], {type:'application/json'}));
    await writable.close();
    alert('Manifest regenerat cu succes!');
    await buildMenusFromManifest(manifest);
  }catch(e){ if(e && e.name!=='AbortError'){ console.error(e); alert('Eroare la generarea manifestului.'); } }
}
document.getElementById('regen-manifest').addEventListener('click', generateManifestInBrowser);
window.generateManifestInBrowser = generateManifestInBrowser;

// ------- Init (HTTP ‚Üí manifest | file:// ‚Üí picker) -------
async function init(){
  if (location.protocol.startsWith('http')){
    const manifest = await loadManifestHTTP();
    if (manifest) await buildMenusFromManifest(manifest);
    else {
      // fallback dacƒÉ manifestul lipse»ôte »ôi tot e»ôti pe http
      const hint = document.createElement('div');
      hint.style.margin = '12px 0';
      hint.innerHTML = `<button class="btn" id="pickPagesNow">üìÇ Alege folderul <code>pages</code></button>
        <span style="opacity:.8;margin-left:8px">Manifest lipsƒÉ. Po»õi popula meniurile din dosarul local.</span>`;
      document.querySelector('header .container').appendChild(hint);
      document.getElementById('pickPagesNow').addEventListener('click', buildMenusFromPicker);
    }
  } else {
    // file://
    const hint = document.createElement('div');
    hint.style.margin = '12px 0';
    hint.innerHTML = `<button class="btn" id="pickPagesNow">üìÇ Alege folderul <code>pages</code></button>
      <span style="opacity:.8;margin-left:8px">Rulezi local fƒÉrƒÉ server ‚Äî selecteazƒÉ dosarul <code>pages</code> ca sƒÉ populƒÉm meniurile.</span>`;
    document.querySelector('header .container').appendChild(hint);
    document.getElementById('pickPagesNow').addEventListener('click', buildMenusFromPicker);
  }
  render(location.hash.replace(/^#/,'')||'home');
}
window.addEventListener('hashchange',()=> render(location.hash.replace(/^#/,'') ));
init();
</script>
</body>
</html>

